---
tags:
  - Article
---
- CDE is common desktop environment 
	- is still being distributed with the latest Solaris 10 version (at least till 2024)
- targets a format string bug in the `dtprintinfo setuid` binary distributed with CDE, in order to achieve local root privilege escalation on unpatched Solaris 10 systems
	- affects both Intel and SPARC architectures
	- this article focuses of SPARC
## The Bug
- the bug is in the `check_dir()` function
```
void __0FJcheck_dirPcTBPPP6QStatusLineStructPii(char *param_1, 
  undefined4 param_2, void **param_3, int *param_4, int param_5)
{
	...
  	char *pcVar3;
	...
  	char local_724 [300];
  	char local_5f8 [300];
	...
  	size_t local_c;
	...
  
  	pcVar3 = getenv("REQ_DIR");
  	if (pcVar3 == (char *)0x0) {
    		sprintf(local_724, "/usr/spool/lp/requests/%s/", param_2);
  	} else {
    		pcVar3 = getenv("REQ_DIR");
    		sprintf(local_724, pcVar3, param_2); /* VULN */
  	}
  	local_c = strlen(local_724);
  	sprintf(local_5f8, "/var/spool/lp/tmp/%s/", param_2);
	...
}
```
- bug is a stack-based buffer overflow and a format string bug
	- on the VULN line the value associated with the environment variable `REQ_DIR` is directly passed as the second parameter to `sprintf()`
	- by manipulating this variable a local attacker is easily able to control the format string used by `sprintf()`
	- a user-supplied format string in a `setuid` root program means bad things
- the other `sprintf()` related buffer also overflows
## The Exploit